## Context

当前 SQLite 数据库不直接支持表和列的 COMMENT 语法（如 MySQL 的 COMMENT 'description'），这导致数据库元数据缺乏文档化信息。get_table_schema 工具目前只返回表名、列名、数据类型等基本结构信息，没有描述性注释，增加了代码理解和维护成本。

为解决这个问题，通过引入辅助表机制来存储和查询表注释和列注释信息，在不修改原有数据库结构的情况下增强元数据的文档化能力。

## Goals / Non-Goals

**Goals:**
- 自动检测并创建辅助表（_table_comment 和 _table_column_comment）
- 自动初始化表和列的默认注释（使用表名/列名作为默认值）
- 修改 get_table_schema 工具返回格式，添加 desc 字段到表和列对象
- 确保辅助表创建和默认数据插入的事务一致性

**Non-Goals:**
- 提供注释的创建、更新、删除（CRUD）管理接口
- 支持多语言注释
- 提供注释的批量导入导出功能
- 辅助表的完整性校验和修复工具

## Decisions

### 1. 辅助表 DDL 存储位置
**决策**: 将辅助表的 DDL 存储在 `sql/sqlite_assist_table_ddl.sql` 文件中，在运行时读取并执行。

**理由**:
- 与现有测试数据的 `test.sql` 保持一致的模式
- 便于版本控制和审查 DDL 变更
- 不需要在 Rust 代码中硬编码 SQL，提高可维护性

**替代方案**: 在 Rust 代码中硬编码 DDL 字符串 → 已拒绝，因为降低了可读性和可维护性

### 2. 辅助表检测和创建时机
**决策**: 在每次调用 get_table_schema 时检测并确保辅助表存在（如果不存在则创建）。

**理由**:
- 确保系统自愈能力（即使辅助表被意外删除也能自动恢复）
- 简化部署流程（无需手动执行 DDL）
- 首次调用有轻微性能开销，但后续调用通过表存在检测可快速跳过

**替代方案**: 只在程序启动时创建一次 → 已拒绝，因为如果数据库被替换或表被删除则无法自动恢复

### 3. 默认注释初始化策略
**决策**: 使用表名和列名作为默认注释，在首次查询时通过 INSERT OR IGNORE 插入。

**理由**:
- 提供有意义的默认值（至少是字段名称）
- INSERT OR IGNORE 确保幂等性，可以安全重复执行
- 不影响已存在的自定义注释

**替代方案**: 使用空字符串作为默认值 → 已拒绝，因为空注释无法提供任何有用信息

### 4. 数据结构扩展
**决策**: 扩展 TableSchema 结构体和 Column 结构体，添加可选的 desc 字段。

**理由**:
- 保持向后兼容（desc 字段可选）
- 符合 serde JSON 序列化/反序列化的最佳实践
- 与现有代码风格一致

**替代方案**: 创建新的带注释的结构体类型 → 已拒绝，因为会导致代码复杂度增加

### 5. 事务处理
**决策**: 辅助表创建和默认注释初始化使用单个事务执行。

**理由**:
- 确保原子性（要么全部成功，要么全部失败）
- 避免部分创建导致的不一致状态
- 符合数据库操作的最佳实践

**替代方案**: 分别执行多个语句 → 已拒绝，因为可能导致部分成功的不一致状态

## Risks / Trade-offs

### 性能风险
**风险**: 首次调用 get_table_schema 需要创建两个表并插入所有列的默认注释，可能影响响应时间。

**缓解措施**:
- 使用 INSERT OR IGNORE 避免重复插入的开销
- 缓存辅助表存在性检查结果
- 在日志中记录初始化操作，便于性能监控

### 默认注释质量
**风险**: 使用表名/列名作为默认注释可能不够有意义，用户体验不理想。

**缓解措施**:
- 未来可以提供注释管理接口，允许用户修改默认注释
- 在文档中说明默认注释的来源和更新方式
- 建议用户根据实际需求手动更新注释

### 辅助表命名冲突
**风险**: 辅助表名称（_table_comment 和 _table_column_comment）可能与用户现有表冲突。

**缓解措施**:
- 使用下划线前缀表明这是内部系统表
- 在文档中明确说明辅助表的用途和命名规则
- 未来可考虑配置化辅助表名称

### 数据库兼容性
**风险**: 不同版本的 SQLite 可能有细微的 DDL 语法差异。

**缓解措施**:
- 使用标准 SQLite 语法（当前 DDL 已验证）
- 在测试中验证目标 SQLite 版本兼容性
- 添加错误处理，捕获并报告 DDL 执行失败